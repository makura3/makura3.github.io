---
title: Vue.jsのテンプレート構文とコンパイルについてのまとめ
thumbnail: thumbnail.png
date: 2018-05-23 00:00:00
description: 初心者向けにVue.jsの導入方法からテンプレート構文、コンパイル(コンパイラとビルドの種類)についてまとめました。完全ビルドとランタイム限定ビルドの動作確認用サンプルソースも用意しています。
category: Vue
id: vue-summary
tags:
  - Vue
---

諸事情でVue.jsを触ることになったのでまずはドキュメントの読み込みからはじめました。  
完全に理解出来ているのかどうかを確認するため、内容を忘れないためにも記事としてまとめました。    
<br>
ちなみに`今のVue熟練度は1`(過去にチュートリアルレベルの作品を途中で投げ出したことがある)です。  

<!-- toc -->

## はじめに
この記事は`超初心者向け`の記事となっています。  
<br>
ドキュメントの中の、[インストールページ](https://jp.vuejs.org/v2/guide/installation.html)の解説で、対応バージョンはv2.xです。  

## Vue.jsとは
公式のガイドに大きく、  
> ユーザーインターフェイスを構築するためのプログレッシブフレームワークです。  

と記載がありました。ふむふむ。  
プログレッシブフレームワークとはなんだろう？  

### プログレッシブフレームワーク
仕様変更や機能追加を繰り返すアプリケーションの変化に柔軟に対応できるのが、プログレッシブフレームワークと呼ばれるものです。  

Vue自体はview層だけに焦点を当てたライブラリですが[サポートライブラリ](https://github.com/vuejs/awesome-vue#components--libraries)などの導入により、アプリケーション規模に合わせた機能を提供できるようになっています。  
<br> 
必要な機能を必要な時に足していき、無駄なものは省く。そんなイメージでしょうか。  
なんだかワクワクしてきましたね！

### 導入方法
まずVueを使うための[3種類の利用方法](https://jp.vuejs.org/v2/guide/installation.html)を確認しておきます。  
<br>

#### scriptタグで直接組み込む
開発モード/本番モードでファイルが分かれているので、状況に応じて[公式サイト](https://jp.vuejs.org/v2/guide/installation.html#lt-script-gt-%E7%9B%B4%E6%8E%A5%E7%B5%84%E3%81%BF%E8%BE%BC%E3%81%BF)からダウンロードし読み込んで下さい。  
開発モードでは`警告出力とデバッグモード`がありますが、本番モードでは`警告出力なしかつ圧縮`されています。  
<br>
もしくは[CDN](https://jp.vuejs.org/v2/guide/installation.html#CDN)を使用することでVueのソースが参照可能になります。 

```html
<!-- 略 -->
<head>
  <script src="https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.js"></script>
</head>
<!-- 略 -->
```


#### CLI
Vueでは[オフィシャルCLI](https://github.com/vuejs/vue-cli)が用意されています。  
すぐに環境構築ができるので楽なのですが、右も左も分からない初心者さん(私)にはオススメしていないのでこんなのもあるよぐらいにしておきます。  

#### NPM
公式サイトでも推奨されている方法で、私もこの方法を使用しています。  
Vueのみのインストールは公式に記述されている通りで問題ないですが、加えて使用するモジュールバンドラにそったloaderなどをインストールする必要があります。
```js
// vueだけインストール
npm i -S vue

// webpackを使う場合
npm i -D vue-loader
```

## Vueのコンパイルについて知る

コンパイルについて詳しく解説する前に、まずVueのテンプレート構文3種類について説明します。  
事前にどのような記述方法があるのかを知っておくことで、後述するコンパイルについて理解し易くなると思います。

### テンプレート構文

#### 1.文字列テンプレート
[公式の一番最初](https://jp.vuejs.org/v2/guide/#%E3%82%B3%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%8D%E3%83%B3%E3%83%88%E3%81%AB%E3%82%88%E3%82%8B%E6%A7%8B%E6%88%90)にスッと出てくる記述で、文字列でコンポーネントを定義します。  
下記の例は一行ですが、複数行で書くことも出来ます。  
```js
Vue.component('todo-item', {
  template: '<li>This is a todo</li>'
})
```

#### 2.直接render関数で書く
こちらはrender関数に直接定義しています。  
あ、ちょっと読みにくい...。  

```js
Vue.component('anchored-heading', {
  render: function (createElement) {
    return createElement( 'h' + this.level )
  },
  props: {
    //省略
  }
})
```

#### 3.単一ファイルコンポーネント
一つのファイルにtemplate、script、styleをまとめています。  
一番よく見る書き方です。  
<br>
単一ファイルコンポーネントを扱う場合は、webpackやBrowserifyなどのビルドツールが必要です。  

```xml
<template>
  <div>Hello world!!</div>
</template>

<script>
// 省略
</script>

<style>
<!-- 省略 -->
</style>
```


### テンプレートのコンパイルとレンダリング

Vueはrendar関数(描画関数)に表示したい内容を渡すことでレンダリングするしくみのようです。  
そのためtemplateを使用した場合は、定義したtemplateをrendar関数が読み取れるように変換(コンパイル)を行う必要があります。  
<br>
直接render関数で書いた場合は描画したいものをすでにrendar関数に渡しているので、コンパイルする必要はありません。  
<br>
<br> 
### ビルドのつかいわけ

`templateを使用`した場合コンパイルが必要なので、`完全ビルド`が必要となります。  
文字列テンプレートや、単一ファイルコンポーネントの構文がこれにあたります。

#### 完全ビルドとは？
コンパイルに必要なコンパイラとランタイム※の両方が含まれたビルドになります。   
※ランタイムとは、Vueインスタンスの作成やレンダリングなどコンパイラ以外の機能のことを言います。  

<br>
<br>
<br>

`rendar関数に直接書いた場合`は、コンパイルは必要ないので`ランタイム限定ビルド`で十分です。

#### ランタイム限定ビルドとは？
ランタイムのみが含まれています。  
*完全ビルドに比べておよそ30%ほど軽量*です。  
<br>
ちなみにCDNからVueを導入した場合は、完全ビルド用のvue.jsが読み込まれます。 


## Vueのコンパイルのタイミング

次にこの公式ドキュメントを読んでみてください。  
<br>
> DOM内のテンプレートまたはJavaScript内のテンプレート文字列を使用する場合、テンプレートから描画関数へのコンパイルはその場 (on the fly) で実行されます。  
> <br>
> 通常、ほとんどの場合、これは十分高速ですが、アプリケーションのパフォーマンスが重要な場合は避けるのが最善です。  
    
<br>

簡単に説明すると、テンプレートをコンパイルするタイミングは`ブラウザ上で実行した瞬間だよ`と言っているのです。  
続けて、パフォーマンスが重要な場面では避けたほうがいいよと言っています。  
<br>
そこで、Vueでは事前にコンパイルを行うしくみが用意されています。  
<br>

### 事前にコンパイルする方法
webpackやBrowserifyなどのビルドツールにより実現された`vue`拡張子の単一ファイルコンポーネントを使用するときは、vue-loaderなどを通して事前コンパイルが可能です。  
<br>
これにより、事前にコンパイルしておけば実行時はランタイム限定ビルドで事足りるのです。  
<br>
<br>
つらつら文字で説明しましたが、実際にソースを見た方が分かりやすいと思います。  
私のgithubに[リポジトリ](https://github.com/makura3/Vue-helloWorld)を作りましたので、興味があれば読んでみてください。  
<br>

それぞれのパターンでファイルを分けています。
- 文字列テンプレート＋完全ビルド
- render関数＋ランタイム限定ビルド
- 単一ファイルコンポーネント＋ランタイム限定ビルド

## まとめ
- Vueはサポートライブラリが豊富で、どんな規模のアプリケーションにも対応しやすい
- webpackなどのビルドツールを用いることで、単一ファイルコンポーネントが使えるようになるかつ軽量化されたVueを使うことができる

## おわりに
Vueは珍しく日本語ドキュメントが用意されているものの、読んでいるとどういう意味だろう？と思う点が何度もありました。  
特にコンパイル云々の話は苦手な部分だったので、今回で大分理解が深まりました。  
